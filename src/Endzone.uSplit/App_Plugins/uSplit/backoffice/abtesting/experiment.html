<div ng-controller="uSplit.abTesting.experimentController" class="usplit">
    <form name="overviewForm" ng-submit="refresh()">
        <umb-panel>
            <umb-header tabs="tabs">

                <div class="umb-headline-editor-wrapper span7">
                    <h1>
                        uSplit Experiment - {{loaded?experiment.name:experimentId}} 
                    </h1>
                </div>

                <div class="span5">
                    <div class="btn-toolbar pull-right umb-btn-toolbar">
                        <button type="submit" data-hotkey="ctrl+r" class="btn btn-success">Refresh</button>
                    </div>
                </div>
            </umb-header>

            <umb-tab-view>
                <umb-tab id="tabvariations" rel="variations" class="active">
                    <umb-pane>
                        <div class="row" ng-include="'/App_Plugins/uSplit/backoffice/shared/loader.html'"></div>
                        <div ng-show="loaded">
                            <div class="row" ng-include="'/App_Plugins/uSplit/backoffice/shared/noapi.html'"></div>
                        </div>

                        <div ng-show="loaded && apiReady">
                            <div class="row">
                                <div class="span4">
                                    Experiment status
                                </div>
                                <div class="span4">
                                    {{experiment.status}}
                                </div>
                                <div class="span4">
                                    <button ng-show="['DRAFT', 'READY_TO_RUN'].indexOf(experiment.status) > -1" class="btn btn-primary" type="button" ng-click="start()">Commance experiment</button>
                                    <button ng-show="['RUNNING'].indexOf(experiment.status) > -1" class="btn btn-danger" type="button" ng-click="stop()">End experiment</button>
                                </div>
                            </div>

                            <div class="row">
                                <div class="span4">
                                    Name in Google Analytics Experiments
                                </div>
                                <div class="span4">
                                    {{experiment.googleName}}
                                </div>
                            </div>

                            <div class="row">
                                <div class="span4">
                                    Created
                                </div>
                                <div class="span4">
                                    {{experiment.created | date:'dd/MM/yyyy HH:mm:ss'}}
                                </div>
                            </div>

                            <div class="row">
                                <div class="span4">
                                    Updated
                                </div>
                                <div class="span4">
                                    {{experiment.updated | date:'dd/MM/yyyy HH:mm:ss'}}
                                </div>
                            </div>

                            <div class="row">
                                <div class="span4">
                                    Started
                                </div>
                                <div class="span4">
                                    {{experiment.startTime | date:'dd/MM/yyyy HH:mm:ss'}}
                                </div>
                            </div>

                            <div class="row" ng-show="experiment.endTime">
                                <div class="span4">
                                    Ended
                                </div>
                                <div class="span4">
                                    {{experiment.endTime | date:'dd/MM/yyyy HH:mm:ss'}}
                                </div>
                            </div>

                            <div class="row">
                                <div class="span4">
                                    <h3>Variations</h3>
                                </div>
                                <div class="span8">
                                    <h3 class="text-right">
                                        <button class="btn" type="button" ng-disabled="['RUNNING','ENDED'].indexOf(experiment.status) > -1" ng-click="duplicateAsVariation()">
                                            <i class="icon-add"></i> Clone original
                                        </button>
                                        <button class="btn" type="button" ng-disabled="['RUNNING','ENDED'].indexOf(experiment.status) > -1" ng-click="addExistingAsVariation()">
                                            <i class="icon-add"></i> Add existing page
                                        </button>
                                    </h3>
                                </div>
                            </div>

                            <div class="row">
                                <div class="span4">
                                    Page under test
                                </div>
                                <div class="span4">
                                    {{experiment.name}} {{experiment.url}}
                                </div>
                                <div class="span4">
                                    <button class="btn btn-small" type="button" ng-click="editContent(experiment.nodeId)">
                                        <i class="icon-edit"></i> Edit
                                    </button>
                                </div>
                            </div>

                            <div class="row" ng-repeat="variation in experiment.variations">
                                <div class="span4">
                                    Variation {{$index}}
                                </div>
                                <div class="span4">
                                    {{variation.name}} {{variation.url}}
                                </div>
                                <div class="span4">
                                    <button class="btn btn-small" type="button" ng-click="editContent(variation.nodeId)">
                                        <i class="icon-edit"></i> Edit
                                    </button>

                                    <button class="btn btn-small" type="button" ng-click="deleteVariation(variation.name)">
                                        <i class="icon-delete"></i> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </umb-pane>
                </umb-tab>

                <umb-tab id="tabdebug" rel="debug">
                    <umb-pane>
                        <umb-load-indicator ng-if="!loaded"></umb-load-indicator>
                        <div class="row" ng-include="'/App_Plugins/uSplit/backoffice/shared/loader.html'"></div>
                        <div ng-show="loaded">
                            <div class="row" ng-include="'/App_Plugins/uSplit/backoffice/shared/noapi.html'"></div>
                            <div class="row" ng-show="apiReady">
                                <pre>
{{experiment.debug | json}}
</pre>   
                            </div>
                        </div>
                    </umb-pane>
                </umb-tab>
            </umb-tab-view>
        </umb-panel>
    </form>
</div>
